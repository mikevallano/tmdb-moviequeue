
<article class="movie-show">
<div class="row">
  <div class="col-xs-12">

  <div id="movie-splash-container">


    <div class="backdrop-image">
      <%= image_tag "http://image.tmdb.org/t/p/w1280#{@movie.backdrop_path}" %>
    </div> <!-- backdrop-image -->
    <div id="gradient-box">

    </div><!-- gradient-box -->

  </div><!-- movie-splash-container -->
</div> <!-- col-xs-12 -->
</div> <!-- row -->


<div class="row">
  <div class="movie-bottom-details">

    <div class="col-xs-3">
      <div class="sidebar">
      <%= link_to image_for(@movie), movie_more_path(tmdb_id: @movie.tmdb_id), id: "movie_show_link_movie_partial" if @movie.poster_path.present? %>

      <%= render 'movies/movie_screening', movie: @movie %>
      <%= render "movies/movie_watch_info", movie: @movie %>

      </div> <!-- sidebar -->

    </div><!-- col-xs-3 -->

    <div class="col-xs-9">

    <h1><%= @movie.title %></h1>
    <p>
    <%= @movie.release_date.stamp("2/21/2001") %> | <%= @movie.mpaa_rating %> | TMDB: <%= @movie.vote_average %>
    <% if current_user.rated_movies.include?(@movie) %>
      | My Rating: <%= link_to "#{@movie.ratings.by_user(current_user).first.value}", movie_rating_path(@movie, @movie.ratings.by_user(current_user).first), id: "show_rating_link_movies_partial" %>
    <% end %><!-- if user rating -->
    <% if @movie.in_db %>
       | <%= @movie.runtime %> min
    <% end %><!-- runtime -->
    |
    <% @movie.genres.each do |genre| %>
      <%= link_to "#{genre}", genre_path(genre), id: "genre_link_movie_show" %>
    <% end %>
    </p>

    <p>
    <% @movie.actors.first(4).each do |actor| %>
      <span class="tag-link"><%= link_to "#{actor}", actor_search_path(actor: actor), id: "actor_link_movie_show" %></span>
    <% end %>
    <span class="tag-link"><%= link_to "#{@movie.director} (director)", director_search_path(director_id: @movie.director_id, name: @movie.director) %></span>
    <%= link_to " Full Cast", full_cast_path(tmdb_id: @movie.tmdb_id), id: "full_cast_link_movie_show", class: "fa fa-chevron-circle-right" %>
     </p>

     <p><%= @movie.overview %></p>



    <h2>Your Viewing Info</h2>
      <!-- TODO: Refactor the shit out of this: -->
      <% @lists_except_movie = current_user.lists_except_movie(@movie) %>

        <div id="movie_tagged_<%= "#{@movie.tmdb_id}" %>">
          <%= render "movies/movie_tag", movie: @movie %>
        </div>

        <div id="movie_show_seen_<%= "#{@movie.tmdb_id}" %>">
          <%= render "movies/movie_show_screening", movie: @movie %>
        </div><!-- movie_seen -->

        <% if @movie.in_db && @movie.lists.by_user(current_user).present? %>

          <div id="movie_on_lists_<%= "#{@movie.tmdb_id}" %>">
            <%= render 'movies/movie_on_lists', movie: @movie %>
          </div>

          <div id="movie_other_list_<%= "#{@movie.tmdb_id}" %>">
            <%= render 'movies/movie_add_to_another_list', movie: @movie %>
          </div>

        <% else %> <!-- # if @movie.in_db && @movie.lists.by_user(current_user).present? -->

          <div id="movie_add_to_first_list_<%= "#{@movie.tmdb_id}" %>">
           <%= render 'movies/movie_add_to_first_list', movie: @movie %>
          </div>

        <% end %> <!-- # if @movie.in_db && @movie.lists.by_user(current_user).present? -->

        <% if current_user.watched_movies.include?(@movie) %>

          <div id="movie_rated_<%= "#{@movie.tmdb_id}" %>">
            <%= render 'movies/movie_rating', movie: @movie %>
          </div>

          <div id="movie_reviewed_<%= "#{@movie.tmdb_id}" %>">
            <%= render 'movies/movie_review', movie: @movie %>
          </div>

        <% end %> <!-- # if (current_user.watched_movies.include?(movie)) -->


      <% if @movie.trailer.present? %> <!-- #if trailer present -->
        <iframe width="560" height="315" src="https://www.youtube.com/embed/<%= @movie.trailer %>" frameborder="0" allowfullscreen></iframe>
      <% else %> <!-- #if trailer present -->
        <a href="https://www.youtube.com/results?search_query=<%= @movie.title %>+movie+official+trailer" target="_blank">Watch the Trailer</a>
      <% end %> <!-- #if trailer present -->

      <% if @production_companies.present? %> <!-- # if @production_companies.present? -->
        <p><strong>Production Companies:</strong>
        <% @production_companies.each do |company| %>
          <%= link_to "#{company[:name]}", discover_search_path(company: company[:id], sort_by: "release_date") %>
        <% end %> <!-- # production companies loop -->
        </p>
      <% end %> <!-- # if @production_companies.present? -->
    </div> <!-- col-xs-9 -->

  </div> <!-- movie-bottom-details -->
</div> <!-- row -->

</article>

